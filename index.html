<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pixel Themed App with Reviews</title>
  <style>
    body {
      margin: 0;
      font-family: "Press Start 2P", monospace;
      background: black;
      color: white;
      text-align: center;
      padding: 20px;
    }

    .page {
      display: none;
    }
    .active {
      display: block;
    }

    button {
      background: #444;
      color: white;
      border: 2px solid white;
      padding: 12px 20px;
      font-family: "Press Start 2P", monospace;
      cursor: pointer;
      margin: 10px;
      font-size: 12px;
    }
    button:hover {
      background: #666;
    }

    input, textarea {
      width: 80%;
      margin: 10px 0;
      padding: 10px;
      font-family: monospace;
      font-size: 14px;
    }

    .stars input {
      display: none;
    }
    .stars label {
      font-size: 30px;
      cursor: pointer;
    }
    .review-card {
      border: 2px solid #555;
      background: #111;
      margin: 10px auto;
      padding: 15px;
      width: 90%;
      max-width: 400px;
      text-align: left;
    }
    .stars-display {
      color: gold;
      font-size: 18px;
      margin: 5px 0;
    }
  </style>
</head>
<body>
  <!-- Intro Page -->
  <div id="introPage" class="page active">
    <h1>Welcome to Pixel Reviews ⭐</h1>
    <button onclick="showPage('reviewFormPage')">Write a Review</button>
    <button onclick="openReviewsPage()">See Reviews</button>
  </div>

  <!-- Write Review Page -->
  <div id="reviewFormPage" class="page">
    <h2>Write a Review</h2>
    <input type="text" id="nickname" placeholder="Your Nickname"><br>
    <textarea id="message" placeholder="Write your review"></textarea><br>

    <div class="stars">
      <input type="radio" id="star5" name="rating" value="5"><label for="star5">★</label>
      <input type="radio" id="star4" name="rating" value="4"><label for="star4">★</label>
      <input type="radio" id="star3" name="rating" value="3"><label for="star3">★</label>
      <input type="radio" id="star2" name="rating" value="2"><label for="star2">★</label>
      <input type="radio" id="star1" name="rating" value="1"><label for="star1">★</label>
    </div>

    <button onclick="submitReview()">Submit</button>
    <button onclick="showPage('introPage')">Back</button>
  </div>

  <!-- Reviews Page -->
  <div id="reviewsPage" class="page">
    <h2>All Reviews</h2>
    <div id="reviewsDisplayPage"></div>
    <button onclick="showPage('introPage')">Back</button>
  </div>

  <!-- Firebase + App Logic -->
  <script type="module">
    // Firebase SDK imports
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, orderBy, query } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyCwwbu-j1UrEex0r517_77P_TKU3mKDZ34",
      authDomain: "live-code-share-62c67.firebaseapp.com",
      projectId: "live-code-share-62c67",
      storageBucket: "live-code-share-62c67.firebasestorage.app",
      messagingSenderId: "20442974828",
      appId: "1:20442974828:web:fdfec35d44e6aed4a5e649",
      measurementId: "G-R4D9K1H34C"
    };

    // Init Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Page switcher
    window.showPage = function(pageId) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.getElementById(pageId).classList.add('active');
    }

    // Submit review to Firestore
    window.submitReview = async function () {
      const nick = document.getElementById('nickname').value.trim();
      const msg = document.getElementById('message').value.trim();
      const star = document.querySelector('input[name="rating"]:checked');

      if (!nick || !msg || !star) {
        alert('Please fill all fields and select a star');
        return;
      }

      try {
        await addDoc(collection(db, "reviews"), {
          nickname: nick,
          message: msg,
          star: parseInt(star.value),
          timestamp: new Date()
        });
        alert("✅ Review submitted!");
        document.getElementById('nickname').value = '';
        document.getElementById('message').value = '';
        document.querySelectorAll('input[name="rating"]').forEach(r => r.checked = false);
        showPage('introPage');
      } catch (err) {
        console.error("Error saving review: ", err);
      }
    }

    // Load reviews from Firestore
    window.openReviewsPage = async function () {
      showPage('reviewsPage');
      const container = document.getElementById('reviewsDisplayPage');
      container.innerHTML = '';

      const q = query(collection(db, "reviews"), orderBy("timestamp", "desc"));
      const querySnapshot = await getDocs(q);

      querySnapshot.forEach(doc => {
        const r = doc.data();
        const div = document.createElement('div');
        div.className = 'review-card';
        div.innerHTML = `
          <strong>${r.nickname}</strong>
          <div class="stars-display">${'★'.repeat(r.star)}${'☆'.repeat(5-r.star)}</div>
          <p>${r.message}</p>
        `;
        container.appendChild(div);
      });
    }
  </script>
</body>
</html>
